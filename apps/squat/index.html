<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Squat Form Checker</title>

    <link rel="stylesheet" href="../../css/style.css" />

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>

    <style>
      :root { color-scheme: dark; }
      html, body { height: 100%; overflow-x: hidden; overflow-y: auto; }
      body { margin: 0; background: #0b0b0c; color: #f3f3f3; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; -webkit-overflow-scrolling: touch; }

      .wrap { max-width: 1100px; margin: 0 auto; padding: 18px; padding-bottom: 40px; }
      .topbar { display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 14px; }
      .back { color: #eaeaea; text-decoration: none; opacity: 0.9; }
      .back:hover { opacity: 1; text-decoration: underline; }
      .title { display: flex; flex-direction: column; gap: 2px; }
      h1 { margin: 0; font-size: 24px; letter-spacing: 0.2px; }
      .sub { margin: 0; color: rgba(255,255,255,0.75); font-size: 13px; }

      .grid { display: grid; grid-template-columns: 1.35fr 0.65fr; gap: 14px; align-items: start; }
      @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }

      .card { background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.10); border-radius: 16px; overflow: hidden; }
      .cardHeader { padding: 12px 12px 10px; display: flex; align-items: center; justify-content: space-between; gap: 10px; border-bottom: 1px solid rgba(255,255,255,0.08); }
      .cardTitle { font-weight: 800; letter-spacing: 0.2px; }
      .badgeRow { display: flex; gap: 8px; flex-wrap: wrap; justify-content: flex-end; }
      .badge { padding: 6px 10px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.14); background: rgba(0,0,0,0.18); font-size: 12px; }

      .stage { position: relative; width: 100%; background: #000; border-bottom: 1px solid rgba(255,255,255,0.08); }
      video, canvas { width: 100%; height: auto; display: block; }
      canvas { position: absolute; inset: 0; }
      .stageSizer { width: 100%; aspect-ratio: 16 / 9; }
      .stageSizer video, .stageSizer canvas { width: 100%; height: 100%; object-fit: cover; }

      .controls { display: flex; gap: 10px; flex-wrap: wrap; padding: 12px; }
      .btn { appearance: none; border: 1px solid rgba(255,255,255,0.18); background: rgba(255,255,255,0.10); color: #fff; padding: 10px 14px; border-radius: 12px; font-weight: 800; cursor: pointer; }
      .btn:hover { background: rgba(255,255,255,0.14); }
      .btn:disabled { opacity: 0.55; cursor: not-allowed; }
      .btnPrimary { background: rgba(255,255,255,0.92); color: #111; border-color: rgba(255,255,255,0.92); }
      .btnPrimary:hover { background: #fff; }
      .toggle { display: inline-flex; align-items: center; gap: 8px; padding: 10px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.18); background: rgba(255,255,255,0.06); }
      .toggle input { transform: scale(1.1); }

      .side { padding: 12px; display: flex; flex-direction: column; gap: 12px; }
      .kpi { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
      .kpiBox { padding: 12px; border-radius: 14px; border: 1px solid rgba(255,255,255,0.10); background: rgba(0,0,0,0.18); }
      .kpiLabel { color: rgba(255,255,255,0.70); font-size: 12px; margin-bottom: 6px; }
      .kpiValue { font-size: 18px; font-weight: 900; letter-spacing: 0.2px; }
      .rules { padding: 12px; border-radius: 14px; border: 1px solid rgba(255,255,255,0.10); background: rgba(0,0,0,0.18); }
      .rules h2 { margin: 0 0 8px; font-size: 14px; letter-spacing: 0.2px; }
      .rules ul { margin: 0; padding-left: 18px; color: rgba(255,255,255,0.78); font-size: 13px; line-height: 1.45; }
      .footer { margin-top: 14px; color: rgba(255,255,255,0.55); font-size: 12px; text-align: center; }

      @media (max-width: 600px) {
        .wrap { padding: 14px; padding-bottom: 50px; }
        h1 { font-size: 20px; }
        .kpi { grid-template-columns: 1fr; }
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <div class="topbar">
        <a class="back" href="../../index.html" target="_self">← Back</a>
        <div class="title">
          <h1>Squat Form Checker</h1>
          <p class="sub">Runs locally in your browser. No uploads.</p>
        </div>
        <div style="width: 44px;"></div>
      </div>

      <div class="grid">
        <div class="card">
          <div class="cardHeader">
            <div class="cardTitle">Camera</div>
            <div class="badgeRow">
              <div class="badge">State: <span id="stateText">idle</span></div>
            </div>
          </div>

          <div class="stage">
            <div class="stageSizer">
              <video id="video" playsinline></video>
              <canvas id="canvas"></canvas>
            </div>
          </div>

          <div class="controls">
            <button id="startBtn" class="btn btnPrimary">Start Camera</button>
            <button id="stopBtn" class="btn" disabled>Stop</button>
            <label class="toggle">
              <input id="mirrorToggle" type="checkbox" checked />
              Mirror
            </label>
          </div>
        </div>

        <div class="card">
          <div class="cardHeader">
            <div class="cardTitle">Session</div>
            <div class="badgeRow">
              <div class="badge">Live</div>
            </div>
          </div>

          <div class="side">
            <div class="kpi">
              <div class="kpiBox">
                <div class="kpiLabel">Reps</div>
                <div class="kpiValue" id="repCount">0</div>
              </div>
              <div class="kpiBox">
                <div class="kpiLabel">Last rep</div>
                <div class="kpiValue" id="verdict">—</div>
              </div>
            </div>

            <div class="rules">
              <h2>How to use</h2>
              <ul>
                <li>Side view works best (hip, knee, ankle visible).</li>
                <li>Make sure your whole body is in frame.</li>
                <li>Good lighting improves tracking.</li>
                <li>Start the camera, then do slow reps.</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="footer">Pose tracking is client-side. Nothing is saved.</div>
    </div>

    <script src="squat.js"></script>
  </body>
</html>
